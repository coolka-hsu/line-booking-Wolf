<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>LINE å®šä½ç³»çµ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 8px; }
    .hidden { display: none; }
    .form-group { margin-bottom: 16px; }
    button { padding: 10px 20px; background: #28a745; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    #timeOptions button { display: block; margin: 5px 0; width: 100%; }
  </style>
</head>
<body>
  <h2>ğŸ“… è«‹é¸æ“‡æƒ³è¦é ç´„çš„æ™‚é–“</h2>
  <div id="timeOptions">è¼‰å…¥ä¸­...</div>

  <form id="bookingForm" class="hidden">
    <h3>è«‹å¡«å¯«ä»¥ä¸‹è³‡è¨Š</h3>
    <div class="form-group">
      <label>ç”¨é¤æ—¥æœŸ</label>
      <input type="text" name="date" readonly>
    </div>
    <div class="form-group">
      <label>ç”¨é¤æ™‚æ®µ</label>
      <input type="text" name="time" readonly>
    </div>
    <div class="form-group">
      <label>è¨‚ä½å¤§å</label>
      <input type="text" name="display_name" placeholder="è«‹å¡«å¯«æ‚¨çš„å§“å">
    </div>
    <div class="form-group">
      <label>Lineç¤¾ç¾¤ID</label>
      <input type="text" name="line_name" placeholder="è«‹å¡«å¯«æ‚¨åœ¨ç¤¾ç¾¤ä¸­çš„åç¨±">
    </div>
    <div class="form-group">
      <label>æ‰‹æ©Ÿè™Ÿç¢¼</label>
      <input type="tel" name="phone" placeholder="è«‹å¡«å¯«æ­£ç¢ºè™Ÿç¢¼ï¼Œé¿å…ç„¡æ³•è¯ç¹«">
    </div>
    <div class="form-group">
      <label>ç”¨é¤äººæ•¸</label>
      <select name="adults">
        <option value="">å¤§äºº (0)</option>
        ${[...Array(11).keys()].map(i => `<option value="${i}">å¤§äºº (${i})</option>`).join('')}
      </select>
      <select name="children">
        <option value="">å°æœ‹å‹ (0)</option>
        ${[...Array(11).keys()].map(i => `<option value="${i}">å°æœ‹å‹ (${i})</option>`).join('')}
      </select>
    </div>
    <div class="form-group">
      <label>å‚™è¨»</label>
      <textarea name="note" placeholder="è‹¥æœ‰å°æœ‹å‹è«‹è¨»è¨˜å¹´é½¡"></textarea>
    </div>
    <button type="submit">é€å‡ºé ç´„</button>
  </form>

  <div id="resultMsg" style="margin-top: 20px;"></div>

  <script>
    const liffId = "2007778847-4d7bwNEV"; // ä½ çš„ LIFF ID
    let profile = {};
    let selected = {};

    async function init() {
      await liff.init({ liffId });
      if (!liff.isLoggedIn()) liff.login();
      profile = await liff.getProfile();

      // å–å¾—å¯è¨‚æ™‚æ®µ
      const res = await fetch("https://script.google.com/macros/s/AKfycbzFfLFp1nUe75gAAPirzMcH6AaDpHgpI2H90nk518jfZzOQg1k7FZgGSJ0Ob-Il9nOa8A/exec");
      const times = await res.json();
      const container = document.getElementById("timeOptions");
      container.innerHTML = "";

      times.forEach(t => {
        const btn = document.createElement("button");
        btn.textContent = `${t.date} ${t.time}`;
        btn.onclick = () => {
          selected = t;
          document.querySelector('input[name="date"]').value = t.date;
          document.querySelector('input[name="time"]').value = t.time;
          document.getElementById("bookingForm").classList.remove("hidden");
          window.scrollTo(0, document.body.scrollHeight);
        };
        container.appendChild(btn);
      });
    }

    document.getElementById("bookingForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = new FormData(e.target);
      const data = {
        liff_uid: profile.userId,
        liff_name: profile.displayName,
        display_name: form.get("display_name"),
        line_name: form.get("line_name"),
        phone: form.get("phone"),
        adults: form.get("adults"),
        children: form.get("children"),
        note: form.get("note"),
        date: selected.date,
        time: selected.time,
        index: selected.index
      };

      const res = await fetch("https://script.google.com/macros/s/AKfycbzFfLFp1nUe75gAAPirzMcH6AaDpHgpI2H90nk518jfZzOQg1k7FZgGSJ0Ob-Il9nOa8A/exec", {
        method: "POST",
        body: JSON.stringify(data)
      });

      const result = await res.json();
      document.getElementById("resultMsg").textContent = result.message;
      if (result.success) {
        e.target.reset();
        document.getElementById("bookingForm").classList.add("hidden");
      }
    });

    init();
  </script>
</body>
</html>
