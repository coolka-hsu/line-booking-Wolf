<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>LINE å®šä½ç³»çµ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    :root{
      --brand:#28a745;
      --bg:#f5f5f5;
      --text:#333;
      --card:#fff;
      --muted:#666;
      --border:#e9e9e9;
    }
    body { font-family: "Noto Sans TC", system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans TC", sans-serif; padding: 20px; background: var(--bg); color: var(--text); }
    h1,h2,h3{ margin: 0 0 12px; }
    .card {
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,.06);
      border: 1px solid var(--border);
      padding: 18px;
      max-width: 720px;
      margin: 0 auto 16px;
    }
    .hidden { display: none; }

    /* Buttons */
    .btn {
      display: inline-block;
      padding: 12px 18px;
      background: var(--brand);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: .02em;
      font-size: 16px;
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }
    .btn-secondary{ background:#1e88e5; }

    /* [è®Šæ›´4][è®Šæ›´5]ï¼šæ”¾å¤§å…©ç´šç”¨çš„å°ºå¯¸ï¼ˆå¯èª¿æ•´ï¼‰ */
    .btn-xl{ font-size: 20px; padding: 14px 22px; }    /* +2 ç´š */
    .btn-xxl{ font-size: 22px; padding: 16px 24px; }   /* +3 ç´šï¼ˆè¦–è¦ºå†å¤§ä¸€é»ï¼‰ */

    /* loading è¦–è¦ºï¼ˆé€å‡ºæ™‚ç”¨ï¼‰ */
    .btn.loading{ position: relative; pointer-events: none; }
    .btn.loading::after{
      content: "â€¦";
      position: absolute;
      right: -14px;
      animation: blink 1s infinite steps(1);
    }
    @keyframes blink { 50%{ opacity: .2; } }

    .center { text-align:center; }

    /* Form */
    .form-group { margin-bottom: 14px; }
    label { display:block; font-weight:700; margin-bottom:6px; }
    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #dcdcdc;
      border-radius: 8px;
      background: #fff;
      font-size: 16px;
    }
    textarea{ min-height: 88px; resize: vertical; }

    /* Time buttonsï¼ˆå¯èª¿æ•´å­—ç´š/è¡Œè·/ç½®ä¸­ï¼‰ */
    #timeOptions button {
      display: block;
      width: 100%;
      padding: 14px;
      margin: 8px 0;
      background: #fff;
      border: 1px solid #dfe6e9;
      border-radius: 10px;
      cursor: pointer;
      text-align: left;
      font-size: 20px;            /* â† [å¯èª¿æ•´1] æ™‚é–“æŒ‰éˆ•å­—é«”å¤§å° */
      line-height: 2;           /* â† [å¯èª¿æ•´2] è¡Œè· */
    }
    #timeOptions.compact button{ font-size:16px; padding:12px; } /* éœ€è¦ç·Šæ¹Šæ™‚åŠ ä¸Š #timeOptions.compact */
    #timeOptions button:hover{ border-color:#b2bec3; }

    .muted { color: var(--muted); }

    /* Announcement styles */
    .announce h2{ font-size:20px; margin-bottom:8px; }
    .announce p{ margin:8px 0; line-height:1.7; }
    .announce .sep{ margin:10px 0; border-bottom:1px dashed #ddd; }

    /* éŒ¯èª¤æç¤ºçš„éš±è—æ§åˆ¶ */
    .visually-hidden{ position:absolute !important; width:1px; height:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }

  </style>
</head>
<body>

  <!-- é€²å…¥å‰çš„å…¬å‘Šèˆ‡ç¢ºèª -->
  <div id="gate" class="card announce">
<h2>ã€ç”¨é¤èˆ‡è¨‚ä½å…¬å‘Šã€‘</h2>

<p>ğŸ½ <span style="font-size:16px"><strong>ç”¨é¤è²»ç”¨</strong></span></p>

<p><span style="font-size:14px">ãƒ»å¤§æœ‹å‹ï¼ˆ11æ­²å«ä»¥ä¸Šï¼‰ï¼š1000å…ƒ/ä½<br />
ãƒ»å°æœ‹å‹ï¼ˆ10æ­²å«ä»¥ä¸‹ï¼‰ï¼š500å…ƒ/ä½<br />
ãƒ»å°å°æœ‹å‹ï¼ˆ3æ­²å«ä»¥ä¸‹ï¼‰ï¼šå…è²»</span></p>

<p><span style="font-size:14px">â–²è‹¥æœ‰å¦å¤–åŠ é»é¤é»ï¼Œå°‡å¦è¡Œè¨ˆåƒ¹ï¼Œ<strong>è«‹è¨‚ä½å®Œæˆå¾Œæ–¼LINEç¾¤çµ„ç™¼é€è¨Šæ¯å‘ŠçŸ¥è€é—†</strong>ï¼Œä»¥ä¾¿æå‰å‚™æ–™ã€‚</span><br />
<br /></p>

<p>ğŸ“Œ<span style="font-size:16px"> <strong>è¨‚ä½é ˆçŸ¥</strong></span></p>

<p><span style="font-size:14px">1ï¸âƒ£ æœ¬é¤å»³ä»¥ã€Œäººæ•¸ã€è¨ˆè²»ï¼Œé¤é»å°‡ä¾å¯¦éš›ç”¨é¤äººæ•¸è¨­è¨ˆæ­é…ã€‚<br />
2ï¸âƒ£ <strong>è«‹æ–¼è¨‚ä½æ™‚æ­£ç¢ºå¡«å¯«ç”¨é¤äººæ•¸ï¼ˆå«å¤§äººèˆ‡å°å­©ï¼‰</strong>ï¼Œä»¥å…ç¾å ´æ ¸å°æ™‚é€ æˆè²»ç”¨è¨ˆç®—ä¸ç¬¦ã€‚<br />
3ï¸âƒ£ è‹¥éœ€æ›´æ”¹ç”¨é¤äººæ•¸ï¼Œè«‹æ–¼<strong>ç”¨é¤å‰48å°æ™‚</strong>å‘ŠçŸ¥ï¼Œä»¥ä¾¿å»šæˆ¿æº–å‚™é£Ÿæã€‚<br />
4ï¸âƒ£ å› é¤é»ä¾äººæ•¸é å‚™ï¼Œç‚ºé¿å…é£Ÿææµªè²»ï¼Œ<strong>è‹¥ç•¶æ—¥åˆ°å ´äººæ•¸å°‘æ–¼åŸè¨‚ä½äººæ•¸ï¼Œå°‡ä»¥åŸè¨‚ä½äººæ•¸è¨ˆåƒ¹</strong>ã€‚<br />
5ï¸âƒ£ è‹¥è‡¨æ™‚å–æ¶ˆè¨‚ä½ï¼Œè«‹å„˜æ—©é€šçŸ¥æˆ‘å€‘ï¼›<strong>é€¾æœŸæœªé€šçŸ¥å¯èƒ½å½±éŸ¿æ—¥å¾Œè¨‚ä½æ¬Šç›Š</strong>ã€‚<br />
6ï¸âƒ£ ç‚ºç¶­æŒç”¨é¤å“è³ªï¼Œè«‹<strong>æº–æ™‚å…¥å¸­</strong>ï¼›é²åˆ°è¶…é15åˆ†é˜ï¼Œé¤é»å°‡ä¾ç¾å ´ç‹€æ³é€²è¡Œå®‰æ’ã€‚<br />
7ï¸âƒ£ <strong>è‹¥æœ‰ç‰¹æ®Šé£²é£Ÿéœ€æ±‚ï¼ˆå¦‚é£Ÿæéæ•ï¼‰</strong>ï¼Œè«‹æ–¼è¨‚ä½æ™‚äº‹å…ˆå‘ŠçŸ¥ï¼Œæˆ‘å€‘å°‡ç›¡åŠ›å”åŠ©èª¿æ•´ã€‚</span></p>

<p>&nbsp;</p>

<p><span style="color:#cc0000"><span style="font-size:14px">â€»å› ç³»çµ±åŒæ­¥æ™‚é–“å·®ï¼Œå¯èƒ½å‡ºç¾é‡è¤‡è¨‚ä½æƒ…å½¢ï¼Œå¯¦éš›è¨‚ä½ä»¥é¤å»³ç¢ºèªç‚ºä¸»ã€‚</span></span></p>


    <div class="center" style="margin-top:12px;">
      <!-- [è®Šæ›´4]ï¼šæ”¾å¤§å…©ç´šï¼šæ–°å¢ btn-xl æˆ– btn-xxl çš†å¯ -->
      <button id="enterBtn" class="btn btn-xl">æˆ‘å·²é–±è®€ä¸¦åŒæ„ï¼Œé–‹å§‹è¨‚ä½</button>
    </div>
  </div>

  <!-- çœŸæ­£çš„å®šä½ç³»çµ± UIï¼ˆåˆå§‹éš±è—ï¼‰ -->
  <div id="app" class="card hidden">
    <h2>ğŸ“… è«‹é¸æ“‡æƒ³è¦é ç´„çš„æ™‚é–“</h2>
    <div id="timeOptions" class="muted">è¼‰å…¥ä¸­â€¦â€¦è«‹ç¨å€™</div>
  </div>

  <div id="formCard" class="card hidden">
    <form id="bookingForm">
      <h3>è«‹å¡«å¯«ä»¥ä¸‹è³‡è¨Š</h3>

      <div class="form-group">
        <label>ç”¨é¤æ—¥æœŸ</label>
        <input type="text" name="date" readonly>
      </div>

      <div class="form-group">
        <label>ç”¨é¤æ™‚æ®µ</label>
        <input type="text" name="time" readonly>
      </div>

      <div class="form-group">
        <label>è¨‚ä½å¤§å</label>
        <input type="text" name="display_name" placeholder="è«‹å¡«å¯«æ‚¨çš„å§“å" required>
      </div>

      <div class="form-group">
        <label>Lineç¤¾ç¾¤ID</label>
        <input type="text" name="line_name" placeholder="è«‹å¡«å¯«æ‚¨åœ¨ç¤¾ç¾¤ä¸­çš„åç¨±" required>
      </div>

      <div class="form-group">
        <label>æ‰‹æ©Ÿè™Ÿç¢¼</label>
        <input type="tel" name="phone" placeholder="è«‹å¡«å¯«æ­£ç¢ºè™Ÿç¢¼ï¼Œé¿å…ç„¡æ³•è¯ç¹«" required>
      </div>

      <div class="form-group">
        <label>ç”¨é¤äººæ•¸</label>
        <select name="adults" required>
          <option value="">è«‹é¸æ“‡å¤§äººæ•¸é‡</option>
          <option value="1">å¤§äºº(1)</option>
          <option value="2">å¤§äºº(2)</option>
          <option value="3">å¤§äºº(3)</option>
          <option value="4">å¤§äºº(4)</option>
          <option value="5">å¤§äºº(5)</option>
          <option value="6">å¤§äºº(6)</option>
          <option value="7">å¤§äºº(7)</option>
          <option value="8">å¤§äºº(8)</option>
          <option value="9">å¤§äºº(9)</option>
          <option value="10">å¤§äºº(10)</option>
        </select>
        <select name="children" required>
          <option value="0">è«‹é¸æ“‡å°æœ‹å‹æ•¸é‡(0)</option>
          <option value="1">å°æœ‹å‹(1)</option>
          <option value="2">å°æœ‹å‹(2)</option>
          <option value="3">å°æœ‹å‹(3)</option>
          <option value="4">å°æœ‹å‹(4)</option>
          <option value="5">å°æœ‹å‹(5)</option>
          <option value="6">å°æœ‹å‹(6)</option>
          <option value="7">å°æœ‹å‹(7)</option>
          <option value="8">å°æœ‹å‹(8)</option>
          <option value="9">å°æœ‹å‹(9)</option>
          <option value="10">å°æœ‹å‹(10)</option>
        </select>
        <small class="muted">ç¸½äººæ•¸è«‹å‹¿è¶…é 10 ä½</small>
      </div>

      <div class="form-group">
        <label>å‚™è¨»</label>
        <textarea name="note" placeholder="è‹¥æœ‰å°æœ‹å‹è«‹è¨»è¨˜å¹´é½¡"></textarea>
      </div>

      <!-- [è®Šæ›´5]ï¼šé€å‡ºæŒ‰éˆ•æ”¾å¤§å…©ç´šä¸¦ç½®ä¸­ -->
      <div class="center">
        <button type="submit" class="btn btn-xl" id="submitBtn">é€å‡ºé ç´„</button>
      </div>

      <div id="resultMsg" class="muted" style="margin-top: 10px;"></div>
    </form>
  </div>

  <script>
    const liffId = "2007778847-Q4D5dmEV"; // ä½ çš„ LIFF ID
    let profile = {};
    let selected = {};
    let started = false; // é˜²æ­¢é‡è¤‡é»æ“Šï¼ˆgateï¼‰

    const timeOptionsEl = document.getElementById("timeOptions");
    const formCardEl   = document.getElementById("formCard");
    const resultMsgEl  = document.getElementById("resultMsg");

    document.getElementById("enterBtn").addEventListener("click", async () => {
      if (started) return;
      started = true;
      const btn = document.getElementById("enterBtn");
      btn.disabled = true;

      // é¡¯ç¤ºä¸»ç•«é¢ã€éš±è—å…¬å‘Š
      document.getElementById("gate").classList.add("hidden");
      document.getElementById("app").classList.remove("hidden");

      // æ‰é–‹å§‹åˆå§‹åŒ–èˆ‡è¼‰å…¥æ™‚æ®µ
      await startApp();

      // è§£é–ï¼ˆè‹¥è¦é¿å…é‡è¤‡é€²å…¥ï¼Œå¯ä¸è§£ï¼‰
      btn.disabled = false;
    });

    async function startApp() {
      try {
        await liff.init({ liffId });
        if (!liff.isLoggedIn()) liff.login();
        profile = await liff.getProfile();
      } catch (e) {
        console.error("LIFF åˆå§‹åŒ–å¤±æ•—", e);
        timeOptionsEl.textContent = "âŒ ç„¡æ³•åˆå§‹åŒ– LIFFï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
        return;
      }

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbzFfLFp1nUe75gAAPirzMcH6AaDpHgpI2H90nk518jfZzOQg1k7FZgGSJ0Ob-Il9nOa8A/exec");
        const times = await res.json();
        const container = timeOptionsEl;
        container.classList.remove("muted");
        container.innerHTML = "";

        if (!Array.isArray(times) || times.length === 0) {
          container.innerHTML = `
            <div style="padding: 16px; background: #fffbe7; border: 1px solid #ccc; border-radius: 8px;">
              <strong>å¾ˆæŠ±æ­‰ï¼Œæœ¬æœˆè¨‚ä½çš†å·²å…¨æ•¸é å®šå®Œç•¢ï¼Œ</strong><br>
              ä¸‹å€‹æœˆé–‹æ”¾è¨‚ä½æ™‚é–“ï¼Œè«‹é—œæ³¨<br>
              <strong>
                <a href="https://line.me/ti/g2/d94EbuAl2Ts6wmTg-fM6qr4b7Bwpj6c7MDZ5Ug?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank" style="color: #d2691e; text-decoration: underline;">
                  ã€åŒ—å®œ32K "ç‹¼ä¾†äº†ç¢³çƒ¤ç¾Šè…¿"ã€‘LINEç¤¾ç¾¤
                </a>
              </strong>ï¼Œè¬è¬ï¼
            </div>`;
          return;
        }

        times.forEach(t => {
          const btn = document.createElement("button");
          btn.textContent = `${t.date} ${t.time}`;
          btn.onclick = () => {
            // [è®Šæ›´2]ï¼šä½¿ç”¨è€…é‡æ–°é¸æ“‡æ™‚æ¸…é™¤éŒ¯èª¤è¨Šæ¯
            resultMsgEl.textContent = "";
            resultMsgEl.classList.remove("visually-hidden");

            selected = t;
            document.querySelector('input[name="date"]').value = t.date;
            document.querySelector('input[name="time"]').value = t.time;
            formCardEl.classList.remove("hidden");
            document.getElementById("bookingForm").scrollIntoView({ behavior: "smooth", block: "start" });
          };
          container.appendChild(btn);
        });
      } catch (err) {
        console.error("è¼‰å…¥å¯é ç´„æ™‚æ®µå¤±æ•—", err);
        timeOptionsEl.textContent = "âŒ ç„¡æ³•è¼‰å…¥è³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
      }
    }

    // [è®Šæ›´3]ï¼šè‹¥ children >= 1ï¼Œå‚™è¨»æ”¹ç‚ºå¿…å¡«ï¼›å¦å‰‡å–æ¶ˆå¿…å¡«
    const childrenSelect = document.querySelector('select[name="children"]');
    const noteTextarea   = document.querySelector('textarea[name="note"]');
    function updateNoteRequired(){
      const val = parseInt(childrenSelect.value || "0", 10);
      if (val >= 1) {
        noteTextarea.setAttribute("required", "required");
      } else {
        noteTextarea.removeAttribute("required");
      }
    }
    childrenSelect.addEventListener("change", updateNoteRequired);
    // è¼‰å…¥å¾Œå…ˆåŸ·è¡Œä¸€æ¬¡ï¼ˆä»¥ç›®å‰é è¨­å€¼æ±ºå®šæ˜¯å¦å¿…å¡«ï¼‰
    updateNoteRequired();

    document.getElementById("bookingForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const form = new FormData(e.target);
      const adults = parseInt(form.get("adults")) || 0;
      const children = parseInt(form.get("children")) || 0;
      const total = adults + children;

      if (total > 10) {
        resultMsgEl.textContent = "âŒ äººæ•¸è¶…éåä½ï¼Œè«‹é‡æ–°é¸æ“‡";
        return;
      }

      // [è®Šæ›´1]ï¼šé€å‡ºæ™‚é–å®š + loading è¦–è¦ºï¼Œé¿å…é‡è¤‡é€å‡º
      const submitBtn = document.getElementById("submitBtn");
      const prevText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.classList.add("loading");
      submitBtn.textContent = "è™•ç†ä¸­";

      const data = {
        liff_uid: profile.userId,
        liff_name: profile.displayName,
        display_name: (form.get("display_name") || "").trim(),
        line_name: (form.get("line_name") || "").trim(),
        phone: (form.get("phone") || "").trim(),
        adults,
        children,
        note: (form.get("note") || "").trim(),
        date: selected.date,
        time: selected.time,
        index: selected.index
      };

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbzFfLFp1nUe75gAAPirzMcH6AaDpHgpI2H90nk518jfZzOQg1k7FZgGSJ0Ob-Il9nOa8A/exec", {
          method: "POST",
          body: JSON.stringify(data)
        });
        const result = await res.json();

        // é¡¯ç¤ºå¾Œç«¯è¨Šæ¯
        resultMsgEl.textContent = result.message || "";

        // [è®Šæ›´2]ï¼šè‹¥è¢«æ¶èµ°ï¼ˆåŒæ™‚è¨‚ä½è¡çªï¼‰â†’ é¡¯ç¤ºç‰¹å®šè¨Šæ¯ï¼›é‡æ–°é¸æ“‡æ™‚é–“æœƒæ¸…é™¤æ­¤è¨Šæ¯ï¼ˆè¦‹ time button onclickï¼‰
        if (!result.success) {
          // è‹¥å¾Œç«¯æ²’æœ‰å›ºå®š codeï¼Œå¯ç”¨è¨Šæ¯é—œéµå­—åˆ¤æ–·
          const msg = (result.message || "");
          if (/å·²è¢«é è¨‚|å·²é è¨‚|è©²æ—¥æœŸå·²è¢«é è¨‚/.test(msg)) {
            // é¡è‰²æˆ–å¼·èª¿å¯è¦–éœ€è¦åŠ ä¸Š
            resultMsgEl.textContent = "âŒ è©²æ—¥æœŸå·²è¢«é è¨‚ï¼Œè«‹é‡æ–°é¸æ“‡";
          }
          // å¤±æ•—å°±è§£é™¤é–å®šï¼Œè®“ä½¿ç”¨è€…å¯ä»¥é‡è©¦
          submitBtn.disabled = false;
          submitBtn.classList.remove("loading");
          submitBtn.textContent = prevText;
          return;
        }

        // æˆåŠŸï¼šå°å‘ success.html
        const params = new URLSearchParams({
          date: selected.date,
          time: selected.time,
          adults: String(adults),
          children: String(children),
          phone: form.get("phone") || ""
        });
        window.location.href = `https://coolka-hsu.github.io/line-booking-Wolf/success.html?${params.toString()}`;

      } catch (err) {
        console.error("é€å‡ºé ç´„éŒ¯èª¤", err);
        resultMsgEl.textContent = "âŒ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦";
        // è§£é–æŒ‰éˆ•
        submitBtn.disabled = false;
        submitBtn.classList.remove("loading");
        submitBtn.textContent = prevText;
      }
    });
  </script>
</body>
</html>
