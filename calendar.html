<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨‚ä½ç´€éŒ„æ—¥æ›†</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background-color: #f5f7fa;
      color: #333;
      padding: 2rem;
    }
    h1, h2 {
      text-align: center;
      color: #2c3e50;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 2rem;
    }
    .day-box {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      padding: 1rem;
      transition: transform 0.2s;
    }
    .day-box:hover {
      transform: scale(1.02);
    }
    .date-title {
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      color: #2980b9;
    }
    .time-slot {
      background: #ecf0f1;
      border-left: 4px solid #3498db;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      margin-bottom: 0.5rem;
    }
    .info {
      font-size: 0.9rem;
      color: #555;
    }
    .lookup {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      margin-top: 3rem;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }
    .lookup label {
      font-weight: bold;
      display: block;
      margin-top: 1rem;
    }
    .lookup input, .lookup select {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.3rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .lookup button {
      margin-top: 1.5rem;
      width: 100%;
      padding: 0.8rem;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }
    .result, .error {
      margin-top: 1rem;
      font-size: 0.95rem;
      padding: 1rem;
      border-radius: 6px;
    }
    .result {
      background-color: #ecf9f1;
      border-left: 4px solid #27ae60;
    }
    .error {
      background-color: #ffe6e6;
      border-left: 4px solid #e74c3c;
      color: #c0392b;
    }
  </style>
</head>
<body>
  <h1>ğŸ“… å·²è¨‚ä½ç´€éŒ„æ—¥æ›†</h1>
  <div class="calendar" id="calendar"></div>

  <h2>ğŸ” æŸ¥è©¢æˆ‘çš„è¨‚ä½</h2>
  <div class="lookup">
    <label for="datetime">é¸æ“‡è¨‚ä½æ™‚æ®µ</label>
    <select id="datetime"></select>

    <label for="phone">è¼¸å…¥æ‚¨çš„æ‰‹æ©Ÿè™Ÿç¢¼</label>
    <input type="tel" id="phone" placeholder="è«‹è¼¸å…¥å®Œæ•´æ‰‹æ©Ÿè™Ÿç¢¼">

    <button onclick="lookupBooking()">æŸ¥è©¢</button>
    <div id="lookup-result"></div>
  </div>

  <script>
    let allData = [];

    async function loadData() {
      const res = await fetch('https://coolka-hsu.github.io/line-booking-Wolf/booked.json');
      const data = await res.json();
      allData = data;

      // ç”¢ç”Ÿæ—¥æ›†é¡¯ç¤º
      const grouped = {};
      data.forEach(entry => {
        const key = `${entry.date}`;
        if (!grouped[key]) grouped[key] = [];
        grouped[key].push(entry);
      });

      const container = document.getElementById('calendar');
      Object.keys(grouped).sort().forEach(date => {
        const box = document.createElement('div');
        box.className = 'day-box';

        const title = document.createElement('div');
        title.className = 'date-title';
        title.textContent = date;
        box.appendChild(title);

        grouped[date].forEach(entry => {
          const time = document.createElement('div');
          time.className = 'time-slot';
          time.innerHTML = `<strong>${entry.time}</strong><div class="info">LINE åç¨±ï¼š${entry.line_name}<br>é›»è©±æœ«3ç¢¼ï¼š${entry.phone_last3}</div>`;
          box.appendChild(time);
        });

        container.appendChild(box);
      });

      // ç”¢ç”ŸæŸ¥è©¢ä¸‹æ‹‰é¸å–®
      const timeSelect = document.getElementById('datetime');
      const options = [...new Set(data.map(d => `${d.date}ã€€${d.time}`))];
      options.sort().forEach(opt => {
        const option = document.createElement('option');
        option.value = opt;
        option.textContent = opt;
        timeSelect.appendChild(option);
      });
    }

    function lookupBooking() {
      const datetime = document.getElementById('datetime').value;
      const phone = document.getElementById('phone').value.trim();
      const [date, time] = datetime.split('ã€€');
      const result = allData.find(d => d.date === date && d.time === time && phone.endsWith(d.phone_last3));

      const display = document.getElementById('lookup-result');
      display.innerHTML = '';
      if (result && phone.slice(-3) === result.phone_last3) {
        display.className = 'result';
        display.innerHTML = `
          âœ… è¨‚ä½æˆåŠŸï¼š<br>
          ğŸ“… æ—¥æœŸï¼š<strong>${result.date}</strong><br>
          ğŸ• æ™‚æ®µï¼š<strong>${result.time}</strong><br>
          ğŸ™â€â™‚ï¸ LINE åç¨±ï¼š<strong>${result.line_name}</strong><br>
          ğŸ“± æ‰‹æ©Ÿæœ«ä¸‰ç¢¼ï¼š<strong>${result.phone_last3}</strong>
        `;
      } else {
        display.className = 'error';
        display.textContent = 'æŸ¥ç„¡è³‡è¨Šæˆ–å¡«å¯«é›»è©±éŒ¯èª¤ã€‚';
      }
    }

    loadData();
  </script>
</body>
</html>
